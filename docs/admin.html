<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LWG Partners Network — Admin</title>
  <meta name="description" content="Manage products for LWG Partners Network. Local-only admin (no backend)."/>

  <!-- Icons & Styles -->
  <link rel="icon" href="images/logo/blue-logo-512.png"/>
  <link rel="stylesheet" href="css/styles.css"/>

  <!-- Core helpers (cart store, badge, mobile nav) -->
  <script defer src="js/app.js?v=2025-09-07-1"></script>

  <!-- SweetAlert for nicer prompts/toasts (optional but used by products.js if present) -->
  <script defer src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Prevent form resubmission on refresh -->
  <script>
    if (window.history && 'replaceState' in history) {
      window.addEventListener('pageshow', () => history.replaceState(null, '', location.href));
    }
  </script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="wrap header-inner">
      <a class="brand" href="index.html">
        <img src="images/logo/blue-logo-banner.png" alt="LWG Partners Network"/>
        <div class="brand-text">
          <strong>LWG Partners Network</strong>
          <span class="tagline">Quality • Reliability • Impact</span>
        </div>
      </a>

      <!-- Mobile menu button -->
      <button class="nav-toggle"
              aria-label="Toggle navigation" aria-expanded="false" aria-controls="siteNav">
        <span></span><span></span><span></span>
      </button>

      <!-- Main nav -->
      <nav class="nav" id="siteNav">
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html" class="cart-link">Cart <span id="cartBadge" class="badge">0</span></a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap" id="main">
    <section class="card" aria-labelledby="adminTitle">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <h1 id="adminTitle">Admin — Products</h1>

        <!-- Local-only status + tools -->
        <div class="admin-actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <span class="small" style="background:#f1f5f9;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px">
            Mode: <strong>Local (no backend)</strong>
          </span>
          <button id="btnExport" class="btn" type="button" title="Download products.json">Export</button>
          <button id="btnImport" class="btn" type="button" title="Import a products.json file">Import</button>
          <button id="adminRefreshBtn" class="btn ghost" type="button" title="Refresh list">Refresh</button>
        </div>
      </div>

      <p class="muted">
        Add or manage products. Your catalog is saved in this browser only (localStorage). Use
        <em>Export</em> to download <code>products.json</code> and <em>Import</em> to load it on another device.
      </p>

      <!-- Add product form (handled by products.js — local-only) -->
      <form id="productForm" class="form-grid" autocomplete="off" aria-describedby="formHelp">
        <label>Title
          <input name="title" required aria-required="true" placeholder="e.g., Navy White Polo"/>
        </label>

        <label>Category
          <input name="category" placeholder="e.g., Men, Women, Kids, Electronics"/>
        </label>

        <label>Price (NLe)
          <input name="price" type="number" min="0" step="0.01" required aria-required="true" placeholder="200"/>
        </label>

        <label>Stock
          <input name="stock" type="number" min="0" required value="10" aria-required="true"/>
        </label>

        <label>Image URL
          <input name="image" placeholder="https://… (direct image link)"/>
        </label>

        <label class="span-2">Description
          <textarea name="description" rows="3" placeholder="Short description"></textarea>
        </label>

        <p id="formHelp" class="muted small span-2">
          Tip: For images, paste a direct link (for example from an image host or your own domain).
        </p>

        <div class="span-2 actions">
          <button class="btn primary" type="submit">Save Product</button>
          <button class="btn danger" type="button" id="clearProducts" title="Clears local products on this device only">
            Clear Local (Dev)
          </button>
        </div>
      </form>
    </section>

    <section class="card" aria-labelledby="listTitle">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
        <h2 id="listTitle">Existing Products</h2>
        <div class="muted small">Click <em>Delete</em> to remove an item.</div>
      </div>
      <div id="adminList" class="admin-list" aria-live="polite"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="wrap foot">
      <p>© <span id="year"></span> LWG Partners Network — Creating Impact Globally</p>
      <div class="socials">
        <a href="https://wa.me/23272146015" target="_blank" rel="noopener">WhatsApp</a>
        <a href="mailto:info@lwgpartnersnetwork.com">Email</a>
        <a href="https://lwgpartnersnetwork.com" target="_blank" rel="noopener">Website</a>
      </div>
    </div>
  </footer>

  <!-- Page logic: admin helpers (export/import/refresh) -->
  <script>
    // These helpers are only for this page; products.js handles add/delete/list.
    document.addEventListener('DOMContentLoaded', () => {
      const PKEY = 'lwg_products';
      const $ = (s, r=document) => r.querySelector(s);

      const exportBtn  = $('#btnExport');
      const importBtn  = $('#btnImport');
      const refreshBtn = $('#adminRefreshBtn');

      function readProducts(){
        try { return JSON.parse(localStorage.getItem(PKEY) || '[]'); }
        catch { return []; }
      }
      function writeProducts(arr){
        localStorage.setItem(PKEY, JSON.stringify(Array.isArray(arr) ? arr : []));
      }

      // Export products.json
      exportBtn?.addEventListener('click', () => {
        const data = readProducts();
        const blob = new Blob([JSON.stringify(data, null, 2)], { type:'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'products.json';
        a.click();
        URL.revokeObjectURL(a.href);
      });

      // Import products.json
      importBtn?.addEventListener('click', () => {
        const inp = document.createElement('input');
        inp.type = 'file';
        inp.accept = 'application/json,.json';
        inp.addEventListener('change', async () => {
          const f = inp.files?.[0]; if (!f) return;
          try {
            const text = await f.text();
            const arr = JSON.parse(text);
            if (!Array.isArray(arr)) throw new Error('JSON must be an array');
            // Ensure there is an id for every product (shop expects ids)
            const fixed = arr.map(x => ({ ...x, id: x.id || ('sku-' + Math.random().toString(36).slice(2,7)) }));
            writeProducts(fixed);
            window.dispatchEvent(new Event('admin:refresh'));
            window.Swal && Swal.fire({ icon:'success', title:'Imported', timer:1000, showConfirmButton:false });
          } catch (e) {
            window.Swal ? Swal.fire({ icon:'error', title:'Invalid JSON file' }) : alert('Invalid JSON file.');
          }
        });
        inp.click();
      });

      // Refresh list
      refreshBtn?.addEventListener('click', () => {
        window.dispatchEvent(new Event('admin:refresh'));
        window.Swal && Swal.fire({ icon:'info', title:'Refreshing…', timer:600, showConfirmButton:false });
      });
    });
  </script>

  <!-- products.js (LOCAL ONLY version) will attach form/listeners and render the product list -->
  <script defer src="js/products.js?v=local-only-1"></script>
</body>
</html>
