<!doctype html>
<html lang="en">
<head>
  <!-- Meta -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>LWG Partners Network — LWG Shop</title>
  <meta name="description" content="Browse products from LWG Partners Network. Quality • Reliability • Impact."/>
  <meta name="theme-color" content="#002F5F"/>
  <meta name="robots" content="index,follow"/>

  <!-- Canonical (use your live domain if set) -->
  <link rel="canonical" href="https://www.lwgpartnersnetwork.com/shop.html"/>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="LWG Partners Network">
  <meta property="og:title" content="LWG Partners Network — LWG Shop">
  <meta property="og:description" content="Shop quality products with reliable delivery.">
  <meta property="og:image" content="https://www.lwgpartnersnetwork.com/images/logo/blue-logo-512.png">
  <meta property="og:url" content="https://www.lwgpartnersnetwork.com/shop.html">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="LWG Partners Network — LWG Shop"/>
  <meta name="twitter:description" content="Shop quality products with reliable delivery."/>
  <meta name="twitter:image" content="https://www.lwgpartnersnetwork.com/images/logo/blue-logo-512.png"/>

  <!-- Icons + CSS -->
  <link rel="icon" href="images/logo/blue-logo-512.png"/>
  <link rel="stylesheet" href="css/styles.css"/>

  <!-- Core helpers (badge, mobile nav) -->
  <script defer src="js/app.js"></script>

  <!-- Page-only tweaks (alignment + admin) -->
  <style>
    .admin-only { display:none; }
    body[data-admin="true"] .admin-only { display:block; }

    :root { --card-img-h: 220px; }
    .grid-products{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(220px,1fr));
      gap:16px;
      margin-top:12px;
    }
    .product-card{
      display:grid;
      grid-template-rows: var(--card-img-h) auto auto 1fr auto;
      gap:10px;
      border:1px solid #e3e8ef;
      border-radius:12px;
      padding:12px;
      background:#fff;
    }
    .product-card .media{ width:100%; height:var(--card-img-h); border-radius:10px; overflow:hidden; background:#f1f5f9; }
    .product-card .media img{ width:100%; height:100%; object-fit:cover; display:block; }
    .product-card h3{
      margin:0; font-size:1.05rem; line-height:1.3;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
      min-height:2.6em;
    }
    .product-meta{ color:#64748b; font-size:.93rem; min-height:1.2em; }
    .product-desc{
      color:#475569; font-size:.92rem;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
      min-height:2.6em;
    }
    .price{ font-weight:700; }

    .product-actions{
      margin-top:8px;
      display:grid; grid-template-columns:40px 1fr 40px; gap:8px; align-items:center;
    }
    .product-actions .qty-input{
      width:100%; text-align:center; padding:8px 6px;
      border:1px solid #d8e1ee; border-radius:8px;
    }
    .product-actions .btn{
      padding:10px 12px; border-radius:10px;
      border:1px solid #d8e1ee; background:#f8fafc; cursor:pointer;
    }
    .product-actions .btn.icon{ padding:9px 0; font-size:18px; }
    .product-actions .btn.primary{
      grid-column:1 / -1; background:#002F5F; color:#fff; border-color:#002F5F; text-align:center;
    }
    .product-actions .btn.danger{ background:#fff1f2; border-color:#fecdd3 }
    .product-actions .row-admin{ grid-column:1/-1; display:flex; gap:8px; flex-wrap:wrap }

    .shop-tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:6px}
    .shop-tools .btn{padding:8px 12px;border-radius:10px;border:1px solid #d8e1ee;background:#f8fafc;cursor:pointer}
    .notice{border:1px dashed #eab308;background:#fffbea;color:#854d0e;padding:10px;border-radius:10px}
    .form-grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
    .form-grid .span-2{grid-column:1/-1}
    .form-grid label{display:flex;flex-direction:column;gap:6px}
    .form-grid input,.form-grid textarea{padding:10px;border:1px solid #d8e1ee;border-radius:10px}
    .img-preview{display:inline-block;width:110px;height:110px;border:1px dashed #d8e1ee;border-radius:10px;background:#f8fafc;object-fit:cover}
    .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="wrap header-inner">
      <a class="brand" href="index.html">
        <img src="images/logo/blue-logo-banner.png" alt="LWG Partners Network"/>
        <div class="brand-text">
          <strong>LWG Partners Network</strong>
          <span class="tagline">Quality • Reliability • Impact</span>
        </div>
      </a>

      <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="siteNav">
        <span></span><span></span><span></span>
      </button>

      <nav class="nav" id="siteNav">
        <a href="index.html">Home</a>
        <a href="shop.html" aria-current="page">Shop</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="cart.html" class="cart-link">Cart <span id="cartBadge" class="badge">0</span></a>
      </nav>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <section class="card">
      <div class="shop-header">
        <h1>LWG Shop</h1>
        <div class="filters" role="search">
          <label class="visually-hidden" for="searchInput">Search products</label>
          <input id="searchInput" type="search" placeholder="Search products…" aria-label="Search products"/>
          <label class="visually-hidden" for="categoryFilter">Filter by category</label>
          <select id="categoryFilter" aria-label="Filter by category">
            <option value="">All Categories</option>
          </select>
        </div>
      </div>

      <!-- ===== ADMIN ===== -->
      <div class="admin-only">
        <div class="shop-tools">
          <a class="btn" href="129admin.html" target="_blank" rel="noopener">Open Full Admin</a>
          <button id="btnSync"   class="btn" title="Fetch latest data/products.json from the server">Sync from Server</button>
          <button id="btnExport" class="btn">Export products (JSON)</button>
          <button id="btnImport" class="btn">Import products (JSON)</button>
          <button id="btnClear"  class="btn">Clear all products (local)</button>
        </div>

        <details class="add-panel">
          <summary id="panelSummary">➕ Add a Product</summary>
          <div style="margin-top:10px">
            <div class="form-grid">
              <input id="pId" type="hidden"/>

              <label>Title
                <input id="pTitle" placeholder="Product title"/>
              </label>
              <label>Price (NLe)
                <input id="pPrice" type="number" min="0" step="1" placeholder="250"/>
              </label>
              <label>Category
                <input id="pCategory" placeholder="Men / Women / Kids / Electronics"/>
              </label>

              <label>Image URL / Path
                <input id="pImage" placeholder="images/products/polo1.jpg or https://…"/>
              </label>
              <label>Or choose image file
                <input id="pImageFile" type="file" accept="image/*"/>
              </label>
              <div class="span-2">
                <img id="pPreview" class="img-preview" alt="preview"/>
              </div>

              <label class="span-2">Description
                <textarea id="pDesc" rows="3" placeholder="Short description for this product"></textarea>
              </label>
              <label>Stock
                <input id="pStock" type="number" min="0" step="1" placeholder="50"/>
              </label>
              <div class="span-2" style="display:flex; gap:8px; flex-wrap:wrap">
                <button id="btnAdd" class="btn" style="background:#002F5F;color:#fff;border-color:#002F5F">Add Product</button>
                <button id="btnReset" class="btn">Reset</button>
              </div>
            </div>
            <p class="notice" style="margin-top:10px">
              Tip: to publish for everyone, export and update <code>docs/data/products.json</code> in your repo.
              New visitors to the Shop auto-load from that server file.
            </p>
          </div>
        </details>
      </div>
      <!-- ===== /ADMIN ===== -->

      <!-- Products grid -->
      <div id="productGrid" class="grid-products" aria-live="polite"></div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="wrap foot">
      <p>© <span id="year"></span> LWG Partners Network — Creating Impact Globally</p>
      <div class="socials">
        <a href="https://wa.me/23272146015" target="_blank" rel="noopener">WhatsApp</a>
        <a href="mailto:info@lwgpartnersnetwork.com">Email</a>
        <a href="https://www.lwgpartnersnetwork.com" target="_blank" rel="noopener">Website</a>
      </div>
    </div>
  </footer>

  <!-- Inline script: products store + Admin Mode + server sync + proper EDIT -->
  <script>
    (function(){
      const KEY = 'lwg_products';
      const REMOTE_HASH_KEY = 'lwg_products_remote_hash';
      const CART_KEY = 'lwg_cart';
      const ADMIN_KEY = 'lwg_admin';
      // Same file the public site uses
      const REMOTE_URL = 'data/products.json';

      const $ = (s, el=document)=>el.querySelector(s);

      // Helpers
      const esc = s=>String(s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
      const escAttr = s=>esc(s).replaceAll('"','&quot;');
      const num = v => Number(String(v).replace(/[^\d.-]/g,'')) || 0;
      const money = n => new Intl.NumberFormat('en-SL',{maximumFractionDigits:0}).format(num(n));
      const slug = s => String(s||'').toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
      const genId = title => `${slug(title)}-${Math.random().toString(36).slice(2,7)}`;
      const hash = obj => {
        try { return String(btoa(unescape(encodeURIComponent(JSON.stringify(obj))))).slice(0,24); }
        catch { return String(Date.now()); }
      };

      // ----- Admin mode
      function setAdmin(on){ document.body.setAttribute('data-admin', on ? 'true':'false'); localStorage.setItem(ADMIN_KEY,on?'1':'0'); }
      function wantAdmin(){ const h=(location.hash||'').toLowerCase(); const q=(location.search||'').toLowerCase(); return h.includes('admin')||q.includes('admin=1'); }
      setAdmin(localStorage.getItem(ADMIN_KEY)==='1' || wantAdmin());
      window.addEventListener('hashchange', ()=>{ if (wantAdmin()) setAdmin(true); });
      window.addEventListener('keydown', (e)=>{ if (e.altKey && e.shiftKey && (e.key.toLowerCase()==='a')) { e.preventDefault(); setAdmin(document.body.getAttribute('data-admin')!=='true'); }});
      const brand=$('.brand');
      if (brand){
        let t=null;
        brand.addEventListener('touchstart', ()=>{ t=setTimeout(()=>setAdmin(document.body.getAttribute('data-admin')!=='true'),700); });
        ['touchend','touchcancel','touchmove'].forEach(ev=>brand.addEventListener(ev, ()=>clearTimeout(t)));
        let taps=0, timer=null;
        brand.addEventListener('click', ()=>{ taps++; if(!timer){ timer=setTimeout(()=>{ if(taps>=5)setAdmin(document.body.getAttribute('data-admin')!=='true'); taps=0; timer=null; },500);} });
      }

      // ----- Storage
      const readProducts = ()=>{ try { return JSON.parse(localStorage.getItem(KEY))||[]; } catch{ return [];} };
      const writeProducts = arr => {
        localStorage.setItem(KEY, JSON.stringify(arr||[]));
        buildCats(arr||[]);
        render();
      };

      // ----- Server sync
      async function fetchRemote(){
        const res = await fetch(REMOTE_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('fetch failed');
        const data = await res.json();
        if (!Array.isArray(data)) throw new Error('bad json');
        return data;
      }
      async function seedFromServerIfEmpty(){
        const local = readProducts();
        if (local.length) return false;
        try {
          const remote = await fetchRemote();
          writeProducts(remote);
          localStorage.setItem(REMOTE_HASH_KEY, hash(remote));
          return true;
        } catch { return false; }
      }
      async function forceSyncFromServer(){
        try {
          const remote = await fetchRemote();
          writeProducts(remote);
          localStorage.setItem(REMOTE_HASH_KEY, hash(remote));
          alert('Synced from server.');
        } catch {
          alert('Could not fetch data/products.json');
        }
      }
      async function softCheckForUpdates(){
        // For returning visitors with local cache: if server changed, refresh silently.
        try {
          const remote = await fetchRemote();
          const h = hash(remote);
          if (h && h !== localStorage.getItem(REMOTE_HASH_KEY)) {
            writeProducts(remote);
            localStorage.setItem(REMOTE_HASH_KEY, h);
          }
        } catch {}
      }

      // ----- Filters
      const grid = $('#productGrid');
      const search = $('#searchInput');
      const catSel = $('#categoryFilter');
      function buildCats(items){
        if (!catSel) return;
        const keep = catSel.value || '';
        const cats = Array.from(new Set((items||[]).map(p=>p.category).filter(Boolean))).sort();
        catSel.innerHTML = '<option value="">All Categories</option>' + cats.map(c=>`<option value="${escAttr(c)}">${esc(c)}</option>`).join('');
        if (cats.includes(keep)) catSel.value = keep;
      }

      // ----- Render aligned cards
      function render(){
        const items = readProducts();
        const term = (search?.value||'').toLowerCase();
        const cat  = catSel?.value || '';
        const admin = document.body.getAttribute('data-admin')==='true';

        const list = items.filter(p=>{
          const okTerm = !term || (String(p.title||'').toLowerCase().includes(term) || String(p.description||'').toLowerCase().includes(term));
          const okCat  = !cat  || String(p.category||'')===cat;
          return okTerm && okCat;
        });

        if (!list.length){
          grid.innerHTML = '<div class="card" style="border-color:#eab308">No products yet. Add some (admin only) or sync from server.</div>';
          return;
        }

        grid.innerHTML = list.map(p=>`
          <article class="product-card" data-id="${escAttr(p.id||'')}">
            <div class="media">
              <img src="${escAttr(p.image||'')}" alt="${escAttr(p.title||'')}"
                   onerror="this.src='images/logo/blue-logo-512.png'"/>
            </div>
            <h3>${esc(p.title||'')}</h3>
            <div class="product-meta">${esc(p.category||'')}</div>
            <p class="product-desc">${esc(p.description||'')}</p>
            <div>
              <div class="price">NLe ${money(p.price)}</div>
              <div class="product-actions">
                <button class="btn icon" data-action="minus" aria-label="decrease">−</button>
                <input class="qty-input" type="number" value="1" min="1" max="${num(p.stock||0)||9999}"/>
                <button class="btn icon" data-action="plus" aria-label="increase">+</button>
                <button class="btn primary" data-action="add">Add to Cart</button>
                ${admin ? `
                  <div class="row-admin">
                    <button class="btn" data-action="edit">Edit</button>
                    <button class="btn danger" data-action="del" title="Remove product">Delete</button>
                  </div>` : ''}
              </div>
            </div>
          </article>
        `).join('');
      }

      // ----- Cart badge
      const readCart = ()=>{ try { return JSON.parse(localStorage.getItem(CART_KEY))||[]; } catch{ return []; } };
      const writeCart = items => { localStorage.setItem(CART_KEY, JSON.stringify(items||[])); updateBadge(); };
      function updateBadge(){
        const bd = $('#cartBadge'); if(!bd) return;
        const count = readCart().reduce((a,it)=>a + (num(it.qty)||0), 0);
        bd.textContent = String(count);
      }

      // ----- Search / Category
      search?.addEventListener('input', render);
      catSel?.addEventListener('change', render);

      // ----- ADMIN wires (form + Edit mode + Sync)
      const addPanel    = document.querySelector('details.add-panel');
      const panelTitle  = document.getElementById('panelSummary');
      const pIdEl       = document.getElementById('pId');
      const btnAdd      = document.getElementById('btnAdd');
      const btnReset    = document.getElementById('btnReset');
      const btnExport   = document.getElementById('btnExport');
      const btnImport   = document.getElementById('btnImport');
      const btnClear    = document.getElementById('btnClear');
      const btnSync     = document.getElementById('btnSync');
      const fileInputEl = document.getElementById('pImageFile');
      const imgUrlEl    = document.getElementById('pImage');
      const previewEl   = document.getElementById('pPreview');

      function fillForm(p){
        document.getElementById('pTitle').value    = p.title || '';
        document.getElementById('pPrice').value    = p.price || '';
        document.getElementById('pCategory').value = p.category || '';
        document.getElementById('pImage').value    = p.image || '';
        document.getElementById('pDesc').value     = p.description || '';
        document.getElementById('pStock').value    = p.stock || '';
        if (previewEl) previewEl.src = p.image || '';
      }
      function clearForm(){
        ['pTitle','pPrice','pCategory','pImage','pDesc','pStock'].forEach(id=>{ const el=$('#'+id); if(el) el.value=''; });
        if (fileInputEl) fileInputEl.value='';
        if (previewEl) previewEl.removeAttribute('src');
      }
      function enterEditMode(product){
        pIdEl.value = product.id;
        fillForm(product);
        if (addPanel) addPanel.open = true;
        if (panelTitle) panelTitle.textContent = '✏️ Edit Product';
        if (btnAdd) btnAdd.textContent = 'Save Changes';
      }
      function exitEditMode(){
        pIdEl.value = '';
        clearForm();
        if (panelTitle) panelTitle.textContent = '➕ Add a Product';
        if (btnAdd) btnAdd.textContent = 'Add Product';
      }

      fileInputEl?.addEventListener('change', ()=>{
        const f = fileInputEl.files?.[0]; if(!f) return;
        const r = new FileReader();
        r.onload = ()=>{ imgUrlEl.value = String(r.result||''); if(previewEl) previewEl.src = imgUrlEl.value; };
        r.readAsDataURL(f);
      });
      imgUrlEl?.addEventListener('input', ()=>{ if(previewEl) previewEl.src = imgUrlEl.value; });

      btnAdd?.addEventListener('click', ()=>{
        const editingId = pIdEl.value.trim();
        const p = {
          title: ($('#pTitle').value||'').trim(),
          price: num($('#pPrice').value),
          category: ($('#pCategory').value||'').trim(),
          image: ($('#pImage').value||'').trim(),
          description: ($('#pDesc').value||'').trim(),
          stock: num($('#pStock').value)
        };
        if (!p.title){ alert('Title is required.'); return; }

        const items = readProducts();

        if (editingId) {
          const idx = items.findIndex(x => String(x.id) === String(editingId));
          if (idx > -1) items[idx] = { ...items[idx], ...p, id: editingId };
          else items.push({ id: editingId, ...p });
          writeProducts(items);
          exitEditMode();
        } else {
          const id = genId(p.title);
          items.push({ id, ...p });
          writeProducts(items);
          clearForm();
        }
      });

      btnReset?.addEventListener('click', ()=>{ exitEditMode(); });

      btnExport?.addEventListener('click', ()=>{
        const blob = new Blob([JSON.stringify(readProducts(), null, 2)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'products.json'; a.click(); URL.revokeObjectURL(a.href);
      });

      btnImport?.addEventListener('click', ()=>{
        const inp = document.createElement('input'); inp.type = 'file'; inp.accept = 'application/json,.json';
        inp.addEventListener('change', async ()=>{
          const f = inp.files?.[0]; if(!f) return;
          try {
            const text = await f.text(); const arr = JSON.parse(text);
            if (!Array.isArray(arr)) throw new Error('JSON must be an array');
            const fixed = arr.map(x => ({...x, id: x.id || genId(x.title||'product')}));
            writeProducts(fixed);
            localStorage.setItem(REMOTE_HASH_KEY, hash(fixed));
          } catch { alert('Invalid JSON file.'); }
        });
        inp.click();
      });

      btnClear?.addEventListener('click', ()=>{ if (confirm('Clear ALL local products?')) writeProducts([]); });

      btnSync?.addEventListener('click', ()=>{ forceSyncFromServer(); });

      // ----- Grid actions (qty, add, edit, delete)
      grid.addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const card = btn.closest('.product-card'); if(!card) return;
        const id = card.dataset.id;
        const items = readProducts();
        const product = items.find(p=>String(p.id)===String(id));
        const qtyInput = card.querySelector('.qty-input');

        if (btn.dataset.action === 'minus') qtyInput.value = Math.max(1, num(qtyInput.value)-1);
        if (btn.dataset.action === 'plus')  qtyInput.value = Math.min(num(product?.stock||9999), num(qtyInput.value)+1);

        if (btn.dataset.action === 'add'){
          const qty = Math.max(1, Math.min(num(product?.stock||9999), num(qtyInput.value)));
          const cart = (function(){ try { return JSON.parse(localStorage.getItem(CART_KEY))||[]; } catch { return []; } })();
          const existing = cart.find(it=>String(it.id)===String(product.id));
          if (existing) existing.qty = num(existing.qty) + qty;
          else cart.push({ id: product.id, title: product.title, price: num(product.price), image: product.image, qty });
          localStorage.setItem(CART_KEY, JSON.stringify(cart||[]));
          updateBadge();
          btn.textContent = 'Added ✓'; setTimeout(()=> btn.textContent='Add to Cart', 900);
        }

        if (btn.dataset.action === 'edit'){
          enterEditMode(product);
        }

        if (btn.dataset.action === 'del'){
          writeProducts(items.filter(p=>String(p.id)!==String(id)));
          if (String(pIdEl.value) === String(id)) exitEditMode();
        }
      });

      // Boot
      (async function boot(){
        await seedFromServerIfEmpty();
        buildCats(readProducts());

        const qparam = new URLSearchParams(location.search).get('q');
        if (qparam && document.getElementById('searchInput')) {
          document.getElementById('searchInput').value = qparam;
        }
        render();
        updateBadge();

        // Soft check for remote updates after load (and again every 10 minutes)
        setTimeout(softCheckForUpdates, 1500);
        setInterval(softCheckForUpdates, 10*60*1000);
      })();
    })();
  </script>
</body>
</html>
